# Workshop 1: random intercept models met INLA

Zie <https://inbo.github.io/tutorials/tutorials/r_inla/>

We beperken de data voorlopig tot de LG3-respons.

```{r}
lg3data <- 
    XG3data %>% 
    filter(Variable == "LG3") %>% 
    rename(Response = Value) %>% 
    select(-Variable)
lg3data %>% str
```


## Challenge 1

### fit fixed effect model

```{r}
I1 <- inla(Response ~ Type + Soiltexture + HYear,
           data = lg3data,
           control.compute = list(dic = TRUE, waic = TRUE),
           family = "gaussian") # gaussian is the default!
summary(I1)
```


### extract $WAIC$ from the model

```{r}
I1 %>% names
```

```{r}
I1$waic %>% str
```

```{r}
I1$waic$waic
```


### display fixed effect parameters in a table

```{r}
I1$summary.fixed %>% 
    rownames_to_column(var = "Fixed_effect") %>% 
    select(Fixed_effect, mean, `0.025quant`, `0.975quant`) %>% 
    kable
```

Citaat uit script `Ex719C_Otolith_V4.R` van A. Zuur:

```
# To make the numerical estimation process 
# easier, we standardize all continous 
# covariates.
```

Laten we dus het volgende proberen en het resultaat vergelijken:

```{r}
MyStd <- function(x) { (x - mean(x)) / sd(x)} # van A. Zuur
lg3data <- 
    lg3data %>% 
    mutate(HYear_std = MyStd(HYear))
```

```{r}
inla(Response ~ Type + Soiltexture + HYear_std,
           data = lg3data,
           control.compute = list(dic = TRUE, waic = TRUE),
           family = "gaussian") %>% 
    .$summary.fixed %>% 
    rownames_to_column(var = "Fixed_effect") %>% 
    select(Fixed_effect, mean, `0.025quant`, `0.975quant`) %>% 
    kable
```

De coëfficiënt van HYear is uiteraard veranderd!
Ook het intercept is veranderd.
Overige parameters zijn niet duidelijk anders.

De snelheid is nauwelijks verbeterd.
Dit heeft mogelijks te maken met het feit dat `HYear` reeds relatief lage waarden had (variërend van 0 tot 27).

```{r}
system.time(inla(Response ~ Type + Soiltexture + HYear,
           data = lg3data,
           control.compute = list(dic = TRUE, waic = TRUE),
           family = "gaussian"))
```

```{r}
system.time(inla(Response ~ Type + Soiltexture + HYear_std,
           data = lg3data,
           control.compute = list(dic = TRUE, waic = TRUE),
           family = "gaussian"))
```

## Challenge 2

### what is the default prior for a fixed effect (`?control.fixed`)

According to the slides of A. Zuur, it is a default of mean = $0$ with precision =$0.001$, i.e. a $\sigma^2$ of $1/0.001 = 1000$, so a $\sigma$ of approx. $31.6$.

Confirmed by `?control.fixed`.


### use a custom prior for a fixed effect (`?inla`)

Laat ons even veronderstellen dat we weten dat de LG3 gemiddeld stijgt met een snelheid van 2 cm per jaar, met een precisie van 10000. Opgelet: stijgen betekent in dit geval dat de respons zakt (diepte onder maaiveld: positief uitgedrukt).

We gaan werken met de niet-getransformeerde HYear om de interpretatie wat makkelijker te houden.

Op basis van code van A. Zuur:

```{r}
I2 <- inla(Response ~ Type + Soiltexture + HYear,
           data = lg3data,
           control.compute = list(waic = TRUE),
           control.fixed = list(
                     mean = list(
                          HYear = -2),
                     prec = list(
                          HYear = 10000)))
summary(I2)
```

We zien dat we de coëfficiënt met een informatieve prior kunnen 'forceren'.


### specify two linear combinations [r-inla.org, FAQ 17](http://www.r-inla.org/faq#TOC-I-have-some-linear-combinations-of-the-nodes-in-the-latent-field-that-I-want-to-compute-the-posterior-marginal-of-is-that-possible-)

Overgeslagen.



## Challenge 3

### fit a model with one or more random intercepts (`model = 'iid'`)
### what is the default prior for `'iid'` (`inla.doc('iid')`)
### calculate $\sigma$ for the random intercept
### display the BLUP the random intercept

## Challenge 4

### Think about the relevant magnitude of $\sigma$ for your random effect
### Use a custom "pc.prec" prior with that $\sigma$ (`inla.doc("pc.prec")`)


## Challenge 5

### pick a relevant variable for an 'rw1' model
### ponder on a relevant $\sigma$ for that model
### fit model with 'rw1' component and `pc.prec` prior
